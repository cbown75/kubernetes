apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: nebula-sync-pihole1
  namespace: flux-system
spec:
  interval: 5m0s
  chart:
    spec:
      chart: apps/nebula-sync-pihole1
      sourceRef:
        kind: GitRepository
        name: flux-system
        namespace: flux-system
      interval: 1m0s
      reconcileStrategy: Revision
  releaseName: nebula-sync-pihole1
  targetNamespace: pihole
  install:
    createNamespace: false
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
      remediateLastFailure: true
  rollback:
    timeout: 10m0s
    recreate: true
  values:
    # Nebula Sync Configuration
    nebulaSync:
      primary:
        url: "https://pihole1.home.cwbtech.net"
        passwordSecretName: "nebula-sync-pihole1-secrets"
        passwordSecretKey: "primary-password"
      replicas:
        urls:
          - "https://pihole2.home.cwbtech.net"
          - "https://pihole7.home.cwbtech.net"
          - "https://pihole8.home.cwbtech.net"
        passwordSecretName: "nebula-sync-pihole1-secrets"
        passwordSecretKeys:
          - "replica-password-1"
          - "replica-password-2"
          - "replica-password-3"
      config:
        fullSync: false
        cron: "*/5 * * * *"
        timezone: "America/Phoenix"
      dns:
        enabled: true
      dhcp:
        enabled: true
      ntp:
        enabled: true
      resolver:
        enabled: true
      database:
        enabled: true
      misc:
        enabled: false
      debug:
        enabled: false
      gravity:
        dhcpLeases: true
        group: true
        adList: true
        adListByGroup: true
        domainList: true
        domainListByGroup: true
        client: true
        clientByGroup: true
    # Sealed Secrets Configuration
    sealedSecrets:
      enabled: true
      secrets:
        nebula-sync-pihole1-secrets:
          primary-password: "AgADCQdYffQqT4bWtAhwPVOXzmOEOR4I4mC63DsFomDgmZfcoRHPFFsnryS1lk0YDoFW+Xz80g4vbNCbalC+9tlFV4hCmGvLxeAwcEytuXp4A46UVI40hQwA08E9bAp6xR8ikw8DNertC7FgVNHUjyH1CJ+jbD524DMtDl5eAYHRf+tLrzpgKAmrWDv96m9QcVDqD7Sf4VshYWYeT2Ko95TpNISFXMv/YmYBgDPlKYDMnRNoi9XZ1Yu/YHpQJLTs8s6k1fqfrkKCCWfcyAzXR9uuokVRVuo4z6ZtwUQ6VexTotIuHJUWwWvcBzLsZj3qjkn7F1tHsFLbWzVy3r6A2a2EPlcqxGq3CUDn4Y0jMZ4Jak8y/Zb/Q75hn1Q8kMmoQ6oiQqWKWIJxX96WWT6eO4RU22r5uUemmPY58a7ESsF7/tOW/uRtRlm4cUu+z/t1LsmbYOzfNgVAaxTj7qK9wfEikshUl9BK8TU5K5ewFJd1MNVT1fSftANdVfFUyZwJtbPEFAI/uIiWWJ2KgW40ZN1cFNUSNPps5qpupJxU0fEwztdgsSBhK4Of3usI6RLp71oaWn7CueP10uxz7R2EqW15a7TpH60xkO+MehyEiteAhJxTY7Penp+DXkpv+8fqwPT8sRIpR8jOqHeV6qxbCOnpfzxJGqfLgUjdjfrm3xOYlx4Y1evmF0Bx9/0B5Aj3u4wHqx+3kYMoTaU2"
          replica-password-1: "AgADCQdYffQqT4bWtAhwPVOXzmOEOR4I4mC63DsFomDgmZfcoRHPFFsnryS1lk0YDoFW+Xz80g4vbNCbalC+9tlFV4hCmGvLxeAwcEytuXp4A46UVI40hQwA08E9bAp6xR8ikw8DNertC7FgVNHUjyH1CJ+jbD524DMtDl5eAYHRf+tLrzpgKAmrWDv96m9QcVDqD7Sf4VshYWYeT2Ko95TpNISFXMv/YmYBgDPlKYDMnRNoi9XZ1Yu/YHpQJLTs8s6k1fqfrkKCCWfcyAzXR9uuokVRVuo4z6ZtwUQ6VexTotIuHJUWwWvcBzLsZj3qjkn7F1tHsFLbWzVy3r6A2a2EPlcqxGq3CUDn4Y0jMZ4Jak8y/Zb/Q75hn1Q8kMmoQ6oiQqWKWIJxX96WWT6eO4RU22r5uUemmPY58a7ESsF7/tOW/uRtRlm4cUu+z/t1LsmbYOzfNgVAaxTj7qK9wfEikshUl9BK8TU5K5ewFJd1MNVT1fSftANdVfFUyZwJtbPEFAI/uIiWWJ2KgW40ZN1cFNUSNPps5qpupJxU0fEwztdgsSBhK4Of3usI6RLp71oaWn7CueP10uxz7R2EqW15a7TpH60xkO+MehyEiteAhJxTY7Penp+DXkpv+8fqwPT8sRIpR8jOqHeV6qxbCOnpfzxJGqfLgUjdjfrm3xOYlx4Y1evmF0Bx9/0B5Aj3u4wHqx+3kYMoTaU2"
          replica-password-2: "AgADCQdYffQqT4bWtAhwPVOXzmOEOR4I4mC63DsFomDgmZfcoRHPFFsnryS1lk0YDoFW+Xz80g4vbNCbalC+9tlFV4hCmGvLxeAwcEytuXp4A46UVI40hQwA08E9bAp6xR8ikw8DNertC7FgVNHUjyH1CJ+jbD524DMtDl5eAYHRf+tLrzpgKAmrWDv96m9QcVDqD7Sf4VshYWYeT2Ko95TpNISFXMv/YmYBgDPlKYDMnRNoi9XZ1Yu/YHpQJLTs8s6k1fqfrkKCCWfcyAzXR9uuokVRVuo4z6ZtwUQ6VexTotIuHJUWwWvcBzLsZj3qjkn7F1tHsFLbWzVy3r6A2a2EPlcqxGq3CUDn4Y0jMZ4Jak8y/Zb/Q75hn1Q8kMmoQ6oiQqWKWIJxX96WWT6eO4RU22r5uUemmPY58a7ESsF7/tOW/uRtRlm4cUu+z/t1LsmbYOzfNgVAaxTj7qK9wfEikshUl9BK8TU5K5ewFJd1MNVT1fSftANdVfFUyZwJtbPEFAI/uIiWWJ2KgW40ZN1cFNUSNPps5qpupJxU0fEwztdgsSBhK4Of3usI6RLp71oaWn7CueP10uxz7R2EqW15a7TpH60xkO+MehyEiteAhJxTY7Penp+DXkpv+8fqwPT8sRIpR8jOqHeV6qxbCOnpfzxJGqfLgUjdjfrm3xOYlx4Y1evmF0Bx9/0B5Aj3u4wHqx+3kYMoTaU2"
          replica-password-3: "AgADCQdYffQqT4bWtAhwPVOXzmOEOR4I4mC63DsFomDgmZfcoRHPFFsnryS1lk0YDoFW+Xz80g4vbNCbalC+9tlFV4hCmGvLxeAwcEytuXp4A46UVI40hQwA08E9bAp6xR8ikw8DNertC7FgVNHUjyH1CJ+jbD524DMtDl5eAYHRf+tLrzpgKAmrWDv96m9QcVDqD7Sf4VshYWYeT2Ko95TpNISFXMv/YmYBgDPlKYDMnRNoi9XZ1Yu/YHpQJLTs8s6k1fqfrkKCCWfcyAzXR9uuokVRVuo4z6ZtwUQ6VexTotIuHJUWwWvcBzLsZj3qjkn7F1tHsFLbWzVy3r6A2a2EPlcqxGq3CUDn4Y0jMZ4Jak8y/Zb/Q75hn1Q8kMmoQ6oiQqWKWIJxX96WWT6eO4RU22r5uUemmPY58a7ESsF7/tOW/uRtRlm4cUu+z/t1LsmbYOzfNgVAaxTj7qK9wfEikshUl9BK8TU5K5ewFJd1MNVT1fSftANdVfFUyZwJtbPEFAI/uIiWWJ2KgW40ZN1cFNUSNPps5qpupJxU0fEwztdgsSBhK4Of3usI6RLp71oaWn7CueP10uxz7R2EqW15a7TpH60xkO+MehyEiteAhJxTY7Penp+DXkpv+8fqwPT8sRIpR8jOqHeV6qxbCOnpfzxJGqfLgUjdjfrm3xOYlx4Y1evmF0Bx9/0B5Aj3u4wHqx+3kYMoTaU2"
    # Security Configuration
    podSecurityContext:
      runAsNonRoot: true
      runAsUser: 65534
      runAsGroup: 65534
      fsGroup: 65534
      seccompProfile:
        type: RuntimeDefault
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
          - ALL
    # Resource Configuration
    resources:
      limits:
        memory: "256Mi"
        cpu: "200m"
      requests:
        memory: "128Mi"
        cpu: "100m"
    # Network Policy
    networkPolicy:
      enabled: true
      egress:
        - to: []
          ports:
            - protocol: UDP
              port: 53
            - protocol: TCP
              port: 53
        - to: []
          ports:
            - protocol: TCP
              port: 80
            - protocol: TCP
              port: 443
    # Service Configuration
    service:
      enabled: false
  dependsOn:
    - name: sealed-secrets
      namespace: kube-system
