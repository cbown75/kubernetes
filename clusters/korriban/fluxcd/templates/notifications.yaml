{{- if and .Values.notifications.slack.enabled .Values.notifications.slack.webhookUrl }}
apiVersion: notification.toolkit.fluxcd.io/v1beta1
kind: Provider
metadata:
  name: slack-provider
  labels:
    {{- include "fluxcd.labels" . | nindent 4 }}
spec:
  type: slack
  address: {{ .Values.notifications.slack.webhookUrl | quote }}
---
apiVersion: notification.toolkit.fluxcd.io/v1beta1
kind: Alert
metadata:
  name: flux-alert-slack
  labels:
    {{- include "fluxcd.labels" . | nindent 4 }}
spec:
  providerRef:
    name: slack-provider
  eventSeverity: info
  eventSources:
    - kind: GitRepository
    - kind: Kustomization
{{- end }}

{{- if and .Values.notifications.discord.enabled .Values.notifications.discord.webhookUrl }}
apiVersion: notification.toolkit.fluxcd.io/v1beta1
kind: Provider
metadata:
  name: discord-provider
  labels:
    {{- include "fluxcd.labels" . | nindent 4 }}
spec:
  type: discord
  address: {{ .Values.notifications.discord.webhookUrl | quote }}
---
apiVersion: notification.toolkit.fluxcd.io/v1beta1
kind: Alert
metadata:
  name: flux-alert-discord
  labels:
    {{- include "fluxcd.labels" . | nindent 4 }}
spec:
  providerRef:
    name: discord-provider
  eventSeverity: info
  eventSources:
    - kind: GitRepository
    - kind: Kustomization
{{- end }}
