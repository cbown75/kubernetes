apiVersion: v1
kind: ConfigMap
metadata:
  name: alloy-singleton
  namespace: monitoring
  labels:
    app.kubernetes.io/name: alloy
    app.kubernetes.io/component: singleton
    app.kubernetes.io/part-of: monitoring-stack
data:
  config.alloy: |
    // Loki remote write endpoint
    loki.write "loki_external" {
      endpoint {
        url = "http://loki.monitoring.svc.cluster.local:3100/loki/api/v1/push"
      }
    }

    // Kubernetes events collection
    loki.source.kubernetes_events "cluster_events" {
      job_name   = "integrations/kubernetes/eventhandler"
      log_format = "logfmt"
      forward_to = [loki.write.loki_external.receiver]
    }
