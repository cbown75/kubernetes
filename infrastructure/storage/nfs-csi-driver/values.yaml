# NFS CSI Driver Configuration
nfsServers:
  holocron:
    host: "holocron.home.cwbtech.net"
    shares:
      fast: "/volume1/k8s-fast"
      general: "/volume1/k8s-general"
      backup: "/volume1/k8s-backup"
  sith:
    host: "sith.home.cwbtech.net"
    shares:
      fast: "/volume1/k8s-fast"
      general: "/volume1/k8s-general"
      backup: "/volume1/k8s-backup"

# CSI Driver Configuration
image:
  nfs:
    repository: registry.k8s.io/sig-storage/nfsplugin
    tag: v4.10.0 # Downgraded from v4.11.0 for stability
    pullPolicy: IfNotPresent

  csiProvisioner:
    repository: registry.k8s.io/sig-storage/csi-provisioner
    tag: v5.3.0
    pullPolicy: IfNotPresent

  csiSnapshotter:
    repository: registry.k8s.io/sig-storage/csi-snapshotter
    tag: v8.3.0
    pullPolicy: IfNotPresent

  csiResizer:
    repository: registry.k8s.io/sig-storage/csi-resizer
    tag: v1.14.0
    pullPolicy: IfNotPresent

  livenessProbe:
    repository: registry.k8s.io/sig-storage/livenessprobe
    tag: v2.16.0
    pullPolicy: IfNotPresent

  nodeDriverRegistrar:
    repository: registry.k8s.io/sig-storage/csi-node-driver-registrar
    tag: v2.13.0
    pullPolicy: IfNotPresent

# Kubelet directory path (adjust for your cluster)
kubeletDir: /var/lib/kubelet

# Feature gates
feature:
  enableFSGroupPolicy: true
  enableInlineVolume: false

# Controller configuration
controller:
  replicas: 1
  logLevel: 2
  healthPort: 39652 # Custom port to avoid conflicts
  resources:
    csiProvisioner:
      limits:
        memory: 400Mi
      requests:
        cpu: 10m
        memory: 20Mi
    csiSnapshotter:
      limits:
        memory: 200Mi
      requests:
        cpu: 10m
        memory: 20Mi
    csiResizer:
      limits:
        memory: 400Mi
      requests:
        cpu: 10m
        memory: 20Mi
    livenessProbe:
      limits:
        memory: 100Mi
      requests:
        cpu: 10m
        memory: 20Mi
    nfs:
      limits:
        memory: 200Mi
      requests:
        cpu: 10m
        memory: 20Mi

# Node configuration
node:
  logLevel: 2
  healthPort: 39653 # Custom port to avoid conflicts
  resources:
    livenessProbe:
      limits:
        memory: 100Mi
      requests:
        cpu: 10m
        memory: 20Mi
    nodeDriverRegistrar:
      limits:
        memory: 100Mi
      requests:
        cpu: 10m
        memory: 20Mi
    nfs:
      limits:
        memory: 300Mi
      requests:
        cpu: 10m
        memory: 20Mi

# Storage Classes configuration
storageClasses:
  # Holocron NAS storage classes
  holocronFast:
    enabled: true
    name: nfs-holocron-fast
    server: holocron
    share: fast
    reclaimPolicy: Delete
    volumeBindingMode: Immediate
    allowVolumeExpansion: true
    mountOptions:
      - hard
      - nfsvers=4.1
      - intr
    annotations: {}
    labels:
      nas: holocron
      tier: fast

  holocronGeneral:
    enabled: true
    name: nfs-holocron-general
    server: holocron
    share: general
    reclaimPolicy: Retain
    volumeBindingMode: Immediate
    allowVolumeExpansion: true
    mountOptions:
      - hard
      - nfsvers=4.1
      - intr
    annotations: {}
    labels:
      nas: holocron
      tier: general

  holocronBackup:
    enabled: true
    name: nfs-holocron-backup
    server: holocron
    share: backup
    reclaimPolicy: Retain
    volumeBindingMode: Immediate
    allowVolumeExpansion: true
    mountOptions:
      - hard
      - nfsvers=4.1
      - intr
    annotations: {}
    labels:
      nas: holocron
      tier: backup

  # Sith NAS storage classes
  sithFast:
    enabled: true
    name: nfs-sith-fast
    server: sith
    share: fast
    reclaimPolicy: Delete
    volumeBindingMode: Immediate
    allowVolumeExpansion: true
    mountOptions:
      - hard
      - nfsvers=4.1
      - intr
    annotations: {}
    labels:
      nas: sith
      tier: fast

  sithGeneral:
    enabled: true
    name: nfs-sith-general
    server: sith
    share: general
    reclaimPolicy: Retain
    volumeBindingMode: Immediate
    allowVolumeExpansion: true
    mountOptions:
      - hard
      - nfsvers=4.1
      - intr
    annotations: {}
    labels:
      nas: sith
      tier: general

  sithBackup:
    enabled: true
    name: nfs-sith-backup
    server: sith
    share: backup
    reclaimPolicy: Retain
    volumeBindingMode: Immediate
    allowVolumeExpansion: true
    mountOptions:
      - hard
      - nfsvers=4.1
      - intr
    annotations: {}
    labels:
      nas: sith
      tier: backup

# Default Storage Class
defaultStorageClass: nfs-holocron-fast

# RBAC
rbac:
  create: true

# Service Account
serviceAccount:
  create: true
  controller: csi-nfs-controller-sa
  node: csi-nfs-node-sa

# Node selector (for Linux nodes only)
linux:
  enabled: true

# Tolerations for controller pod
tolerations:
  - key: CriticalAddonsOnly
    operator: Exists
  - key: node-role.kubernetes.io/control-plane
    operator: Exists
    effect: NoSchedule
  - key: node-role.kubernetes.io/controlplane
    operator: Exists
    effect: NoSchedule
  - key: node-role.kubernetes.io/master
    operator: Exists
    effect: NoSchedule

# Priority class
priorityClassName: system-cluster-critical

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 65534
  seccompProfile:
    type: RuntimeDefault

# Override settings
nameOverride: ""
fullnameOverride: ""
